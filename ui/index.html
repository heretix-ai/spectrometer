<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Heretix — Bias Spectrometer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #050505;
    --surface: #0a0a0a;
    --surface-2: #111111;
    --border: #1a1a1a;
    --border-accent: #222222;
    --text: #e8e8e8;
    --text-muted: #777777;
    --text-dim: #555555;
    --green: #00ff41;
    --green-dim: rgba(0, 255, 65, 0.15);
    --green-glow: rgba(0, 255, 65, 0.08);
    --gpt-color: #10b981;
    --gemini-color: #6366f1;
    --grok-color: #f59e0b;
    --radius: 12px;
    --radius-sm: 8px;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', -apple-system, sans-serif;
    line-height: 1.5;
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
  }

  .container {
    max-width: 680px;
    margin: 0 auto;
    padding: 48px 20px 80px;
  }

  /* ── Header ──────────────────────────────── */
  .header {
    text-align: center;
    margin-bottom: 48px;
  }
  .header h1 {
    font-size: 15px;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 6px;
  }
  .header p {
    font-size: 13px;
    color: var(--text-dim);
  }

  /* ── Model legend ─────────────────────────── */
  .model-legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 12px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: var(--text-muted);
  }
  .legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  /* ── Input ───────────────────────────────── */
  .input-section {
    margin-bottom: 40px;
  }
  .input-wrap {
    display: flex;
    gap: 10px;
    align-items: stretch;
  }
  .input-wrap input {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px 18px;
    font-size: 16px;
    color: var(--text);
    font-family: inherit;
    outline: none;
    transition: border-color 0.2s;
  }
  .input-wrap input::placeholder { color: var(--text-dim); }
  .input-wrap input:focus { border-color: var(--green); box-shadow: 0 0 0 1px var(--green-dim); }
  .input-wrap button {
    background: var(--green);
    color: #000;
    border: none;
    border-radius: var(--radius);
    padding: 14px 28px;
    font-size: 15px;
    font-weight: 600;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: opacity 0.15s;
  }
  .input-wrap button:hover { opacity: 0.85; }
  .input-wrap button:disabled { opacity: 0.4; cursor: not-allowed; }

  /* ── Loading ─────────────────────────────── */
  .loading { display: none; text-align: center; padding: 60px 0; }
  .loading.active { display: block; }
  .loading-text { color: var(--text-muted); font-size: 14px; }
  .loading-bar {
    width: 200px;
    height: 2px;
    background: var(--border);
    border-radius: 2px;
    margin: 16px auto 0;
    overflow: hidden;
  }
  .loading-bar::after {
    content: '';
    display: block;
    width: 40%;
    height: 100%;
    background: var(--green);
    border-radius: 2px;
    animation: loading-slide 1.2s ease-in-out infinite;
  }
  @keyframes loading-slide {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(350%); }
  }

  /* ── Results ─────────────────────────────── */
  .results { display: none; }
  .results.active { display: block; }

  .claim-display {
    text-align: center;
    margin-bottom: 36px;
  }
  .claim-label {
    font-size: 11px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 8px;
  }
  .claim-text {
    font-size: 22px;
    font-weight: 600;
    color: var(--text);
    line-height: 1.35;
  }

  /* ── Gauge ───────────────────────────────── */
  .gauge-section {
    margin-bottom: 32px;
  }
  .gauge-track {
    position: relative;
    height: 6px;
    background: var(--surface-2);
    border-radius: 3px;
    margin: 0 4px;
  }
  .gauge-labels {
    display: flex;
    justify-content: space-between;
    margin-bottom: 14px;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--text-dim);
    padding: 0 4px;
  }
  .gauge-dot {
    position: absolute;
    top: 50%;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    border: 2px solid var(--bg);
    box-shadow: 0 0 8px rgba(0,0,0,0.5);
    transition: left 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 2;
    cursor: default;
  }
  .gauge-dot .tooltip {
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background: var(--surface-2);
    border: 1px solid var(--border-accent);
    border-radius: 6px;
    padding: 4px 10px;
    font-size: 12px;
    font-weight: 500;
    font-family: 'JetBrains Mono', monospace;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
  }
  .gauge-dot:hover .tooltip { opacity: 1; }
  .gauge-ticks {
    display: flex;
    justify-content: space-between;
    padding: 6px 4px 0;
  }
  .gauge-ticks span {
    font-size: 10px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-dim);
  }

  /* ── Consensus line ──────────────────────── */
  .consensus {
    text-align: center;
    margin-bottom: 32px;
    padding: 20px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
  }
  .consensus-text {
    font-size: 15px;
    color: var(--text);
    line-height: 1.5;
  }
  .consensus-meta {
    margin-top: 8px;
    font-size: 12px;
    color: var(--text-dim);
    font-family: 'JetBrains Mono', monospace;
  }

  /* ── Signal bullets ──────────────────────── */
  .signals {
    margin-bottom: 32px;
  }
  .signals h3 {
    font-size: 11px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 12px;
  }
  .signal-item {
    display: flex;
    gap: 12px;
    align-items: flex-start;
    padding: 12px 16px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    margin-bottom: 8px;
  }
  .signal-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-top: 6px;
    flex-shrink: 0;
  }
  .signal-text {
    font-size: 14px;
    color: var(--text-muted);
    line-height: 1.45;
  }
  .signal-model {
    font-size: 11px;
    color: var(--text-dim);
    margin-top: 2px;
  }

  /* ── Model detail cards ──────────────────── */
  .model-details {
    margin-bottom: 32px;
  }
  .model-details h3 {
    font-size: 11px;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text-dim);
    margin-bottom: 12px;
  }
  .model-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 10px;
  }
  .model-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    transition: border-color 0.2s;
  }
  .model-card:hover { border-color: var(--border-accent); }
  .model-card-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }
  .model-card-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }
  .model-card-name {
    font-size: 13px;
    font-weight: 500;
    color: var(--text);
  }
  .model-card-prob {
    font-size: 32px;
    font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
    line-height: 1;
    margin-bottom: 4px;
  }
  .model-card-certainty {
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-dim);
    margin-bottom: 10px;
  }
  .model-card-certainty .locked { color: var(--green); }
  .model-card-certainty .stable { color: #6366f1; }
  .model-card-certainty .contested { color: #f59e0b; }
  .model-card-certainty .refused { color: #ef4444; }
  .model-card-grounding {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    padding: 3px 8px;
    border-radius: 4px;
    margin-bottom: 8px;
  }
  .model-card-grounding .g-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
  }
  .grounding-specific { background: rgba(0, 255, 65, 0.08); color: var(--green); }
  .grounding-specific .g-dot { background: var(--green); }
  .grounding-general { background: rgba(245, 158, 11, 0.08); color: #f59e0b; }
  .grounding-general .g-dot { background: #f59e0b; }
  .grounding-none { background: rgba(239, 68, 68, 0.08); color: #ef4444; }
  .grounding-none .g-dot { background: #ef4444; }
  .grounding-unknown { background: rgba(119, 119, 119, 0.08); color: var(--text-dim); }
  .grounding-unknown .g-dot { background: var(--text-dim); }
  .model-card-grounding-note {
    font-size: 11px;
    color: var(--text-dim);
    line-height: 1.35;
    margin-bottom: 8px;
    font-style: italic;
  }
  .model-card-signal {
    font-size: 12px;
    color: var(--text-muted);
    line-height: 1.4;
  }
  .model-card-readings {
    margin-top: 8px;
    font-size: 11px;
    font-family: 'JetBrains Mono', monospace;
    color: var(--text-dim);
  }

  /* ── Footer ──────────────────────────────── */
  .footer {
    text-align: center;
    padding-top: 24px;
    border-top: 1px solid var(--border);
    font-size: 12px;
    color: var(--text-dim);
  }

  /* ── Error ───────────────────────────────── */
  .error {
    display: none;
    text-align: center;
    padding: 40px 0;
    color: #ef4444;
    font-size: 14px;
  }
  .error.active { display: block; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Heretix</h1>
    <p>What do AI models think about this claim?</p>
  </div>

  <div class="input-section">
    <form class="input-wrap" id="claim-form">
      <input type="text" id="claim-input" placeholder="Enter a claim to evaluate..." autocomplete="off" autofocus />
      <button type="submit" id="submit-btn">Analyze</button>
    </form>
    <div class="model-legend">
      <div class="legend-item"><div class="legend-dot" style="background:#10b981"></div>GPT-5</div>
      <div class="legend-item"><div class="legend-dot" style="background:#6366f1"></div>Gemini</div>
      <div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div>Grok</div>
    </div>
  </div>

  <div class="loading" id="loading">
    <div class="loading-text">Reading model weights...</div>
    <div class="loading-bar"></div>
  </div>

  <div class="error" id="error"></div>

  <div class="results" id="results">
    <div class="claim-display">
      <div class="claim-label">Claim evaluated</div>
      <div class="claim-text" id="claim-display"></div>
    </div>

    <div class="gauge-section">
      <div class="gauge-labels">
        <span>False</span>
        <span>True</span>
      </div>
      <div class="gauge-track" id="gauge-track"></div>
      <div class="gauge-ticks">
        <span>0</span><span>25</span><span>50</span><span>75</span><span>100</span>
      </div>
    </div>

    <div class="consensus" id="consensus">
      <div class="consensus-text" id="consensus-text"></div>
      <div class="consensus-meta" id="consensus-meta"></div>
    </div>

    <div class="signals" id="signals-section">
      <h3>What drives this</h3>
      <div id="signals-list"></div>
    </div>

    <div class="model-details">
      <h3>Per-model readings</h3>
      <div class="model-cards" id="model-cards"></div>
    </div>

    <div class="footer">
      These readings reflect model training data, not ground truth.
      <br/>Completed in <span id="latency"></span>s.
    </div>
  </div>
</div>

<script>
const form = document.getElementById('claim-form');
const input = document.getElementById('claim-input');
const submitBtn = document.getElementById('submit-btn');
const loading = document.getElementById('loading');
const error = document.getElementById('error');
const results = document.getElementById('results');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const claim = input.value.trim();
  if (!claim) return;

  // Reset
  loading.classList.add('active');
  results.classList.remove('active');
  error.classList.remove('active');
  submitBtn.disabled = true;

  try {
    const resp = await fetch('/api/spectrometer', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ claim }),
    });
    if (!resp.ok) {
      const err = await resp.json().catch(() => ({}));
      throw new Error(err.error || `Request failed (${resp.status})`);
    }
    const data = await resp.json();
    renderResults(data);
  } catch (err) {
    error.textContent = err.message;
    error.classList.add('active');
  } finally {
    loading.classList.remove('active');
    submitBtn.disabled = false;
  }
});

function renderResults(data) {
  // Claim
  document.getElementById('claim-display').textContent = `"${data.claim}"`;

  // Gauge dots
  const track = document.getElementById('gauge-track');
  track.innerHTML = '';
  for (const m of data.models) {
    if (m.probability === null) continue;
    const dot = document.createElement('div');
    dot.className = 'gauge-dot';
    dot.style.left = `${m.probability}%`;
    dot.style.background = m.color;
    dot.innerHTML = `<div class="tooltip" style="color:${m.color}">${m.name} ${m.probability.toFixed(0)}%</div>`;
    track.appendChild(dot);
  }

  // Consensus
  document.getElementById('consensus-text').textContent = data.consensus.summary;
  const spread = data.consensus.spread !== null ? `${data.consensus.spread.toFixed(0)}pp spread` : '';
  const agreement = data.consensus.agreement;
  document.getElementById('consensus-meta').textContent =
    `${data.meta.n_responded}/${data.meta.n_total} models responded · ${agreement} agreement${spread ? ' · ' + spread : ''}`;

  // Signals
  const signalsList = document.getElementById('signals-list');
  signalsList.innerHTML = '';
  for (const m of data.models) {
    if (!m.signal) continue;
    const item = document.createElement('div');
    item.className = 'signal-item';
    item.innerHTML = `
      <div class="signal-dot" style="background:${m.color}"></div>
      <div>
        <div class="signal-text">${escapeHtml(m.signal)}</div>
        <div class="signal-model">${escapeHtml(m.name)}</div>
      </div>`;
    signalsList.appendChild(item);
  }
  // Show refused models
  for (const m of data.models) {
    if (m.probability !== null) continue;
    const item = document.createElement('div');
    item.className = 'signal-item';
    item.innerHTML = `
      <div class="signal-dot" style="background:#ef4444"></div>
      <div>
        <div class="signal-text">Declined to answer — this model's safety layer flagged this claim.</div>
        <div class="signal-model">${escapeHtml(m.name)}</div>
      </div>`;
    signalsList.appendChild(item);
  }

  // Model cards
  const cardsEl = document.getElementById('model-cards');
  cardsEl.innerHTML = '';
  for (const m of data.models) {
    const card = document.createElement('div');
    card.className = 'model-card';

    const probDisplay = m.probability !== null ? `${m.probability.toFixed(0)}%` : '—';
    const certClass = m.certainty;
    const certLabel = {
      locked: 'locked in',
      stable: 'stable',
      contested: 'contested',
      refused: 'declined',
    }[m.certainty] || m.certainty;

    const groundingLabel = {
      specific: 'grounded',
      general: 'extrapolating',
      none: 'ungrounded',
      unknown: 'unknown',
    }[m.grounding] || 'unknown';

    const groundingClass = `grounding-${m.grounding || 'unknown'}`;

    const readings = m.readings
      .map(r => r !== null ? r.toFixed(0) : '✗')
      .join(', ');

    card.innerHTML = `
      <div class="model-card-header">
        <div class="model-card-dot" style="background:${m.color}"></div>
        <div class="model-card-name">${escapeHtml(m.name)}</div>
      </div>
      <div class="model-card-prob" style="color:${m.color}">${probDisplay}</div>
      <div class="model-card-certainty"><span class="${certClass}">${certLabel}</span>${m.spread !== null ? ` · ${m.spread.toFixed(0)}pp spread` : ''}</div>
      <div class="model-card-grounding ${groundingClass}"><span class="g-dot"></span>${groundingLabel}</div>
      ${m.grounding_note ? `<div class="model-card-grounding-note">${escapeHtml(m.grounding_note)}</div>` : ''}
      <div class="model-card-signal">${m.signal ? escapeHtml(m.signal) : (m.error ? escapeHtml(m.error) : 'No signal')}</div>
      <div class="model-card-readings">runs: ${readings}</div>`;
    cardsEl.appendChild(card);
  }

  // Latency
  document.getElementById('latency').textContent = (data.meta.total_latency_ms / 1000).toFixed(1);

  results.classList.add('active');
}

function escapeHtml(text) {
  const d = document.createElement('div');
  d.textContent = text;
  return d.innerHTML;
}
</script>
</body>
</html>
